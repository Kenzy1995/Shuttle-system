# 飯店接駁車預約系統 - 系統簡介

## 📋 系統概述

本系統為**汐止福泰大飯店**設計的完整接駁車預約與管理解決方案，提供乘客線上預約、即時位置追蹤、司機端出車管理等全方位功能。系統採用現代化雲端架構，確保穩定運作與良好的使用者體驗。

---

## 🏗️ 系統架構

### 一、前端系統

#### 1. **乘客預約網站** (Web Frontend)
- **技術架構**：HTML5 + JavaScript + CSS3
- **部署位置**：Google Cloud Run
- **主要功能**：
  - 班次查詢與預約
  - 預約查詢與管理
  - 即時位置追蹤
  - 多語言支援（中文、英文、日文、韓文）
  - 響應式設計（支援手機、平板、電腦）

#### 2. **司機端移動應用** (Mobile App)
- **技術架構**：React + Capacitor (Android/iOS)
- **主要功能**：
  - GPS 即時定位發送
  - 出車管理（開始/結束行程）
  - QR Code 掃描驗證乘客
  - 乘客名單管理
  - 自動關閉定位功能
  - 系統開關控制

---

### 二、後端服務

#### 1. **預約管理服務** (booking-manager)
- **技術架構**：Flask (Python)
- **主要功能**：
  - 處理預約申請（新增、修改、取消）
  - 預約查詢與驗證
  - QR Code 生成
  - 電子郵件通知發送
  - 預約狀態管理

#### 2. **班次資料服務** (booking-api)
- **技術架構**：Flask (Python)
- **主要功能**：
  - 讀取班次時刻表
  - 提供即時位置資料 API
  - 系統開關狀態檢查
  - 健康檢查端點

#### 3. **司機端服務** (driver-api2)
- **技術架構**：FastAPI (Python)
- **主要功能**：
  - GPS 位置接收與處理
  - 出車開始/結束管理
  - 路線規劃與站點管理
  - 站點到達自動檢測
  - Firebase 資料同步

---

### 三、資料儲存

#### 1. **Google Sheets** (主要資料庫)
- **用途**：儲存所有預約資料、班次資料、系統設定
- **主要工作表**：
  - `預約審核(櫃台)`：所有預約記錄
  - `可預約班次(web)`：班次時刻表
  - `車次管理(櫃台)`：車次與站點資訊
  - `系統`：系統設定與開關

#### 2. **Firebase Realtime Database** (即時資料庫)
- **用途**：即時位置追蹤、當前行程狀態
- **主要資料**：
  - 司機即時 GPS 位置
  - 當前行程資訊
  - 路線與站點資料
  - 系統開關狀態

---

## ✨ 核心功能

### 1. **乘客預約功能**

#### 預約流程
1. **選擇方向**：去程（飯店出發）或回程（返回飯店）
2. **選擇日期**：從可預約日期中選擇
3. **選擇站點**：選擇上車/下車地點
4. **選擇班次**：從可用班次中選擇時間
5. **填寫資料**：
   - 身分選擇（房客/用餐客人）
   - 個人資料（姓名、電話、信箱）
   - 乘客人數（最多 4 人）
   - 相關資訊（房號、入住/退房日期、用餐日期等）
6. **確認預約**：生成預約編號與 QR Code

#### 預約管理
- **查詢預約**：使用預約編號、電話或信箱查詢
- **修改預約**：可修改日期、班次、站點、人數等
- **取消預約**：線上取消預約

#### 特色功能
- **容量檢查**：即時檢查班次剩餘座位
- **多語言介面**：支援中文、英文、日文、韓文
- **響應式設計**：完美適配各種裝置
- **表單驗證**：即時驗證使用者輸入

---

### 2. **即時位置追蹤功能**

#### 功能特色
- **即時地圖顯示**：Google Maps 整合顯示司機位置
- **路線規劃**：自動規劃並顯示完整路線
- **站點標記**：清楚標示所有停靠站點
- **進度顯示**：
  - 已走過路線（綠色，帶閃爍光暈效果）
  - 未走過路線（淺藍色）
  - 下一站提示
- **自動更新**：每 3 分鐘自動更新位置
- **手動刷新**：30 秒冷卻時間限制

#### 顯示資訊
- **司機位置**：圓形裁切的接駁車圖示
- **路線顏色**：綠色（已走過）、淺藍色（未走過）
- **站點標記**：圓形數字標記（1, 2, 3, 4, 5）
- **下一站提示**：
  - 班次未開始：顯示「即將發車中」
  - 班次進行中：顯示「即將抵達: [站點名稱]」

#### 系統控制
- **總開關控制**：可透過 Google Sheets 系統設定控制功能開關
- **範圍限制**：地圖顯示範圍限制在指定區域（4 公里半徑）

---

### 3. **司機端管理功能**

#### GPS 定位系統
- **自動定位發送**：每 3 分鐘自動發送 GPS 位置
- **系統開關**：總開關控制 GPS 功能啟用/停用
- **使用者開關**：司機可手動開啟/關閉定位
- **自動關閉**：發車後 40 分鐘自動關閉定位

#### 出車管理
- **開始出車**：
  - 選擇班次與日期
  - 自動規劃路線
  - 初始化 Firebase 資料
  - 開始 GPS 定位
- **結束出車**：
  - 手動結束或自動結束
  - 更新 Google Sheets 狀態
  - 停止 GPS 定位

#### 乘客驗證
- **QR Code 掃描**：掃描乘客 QR Code 驗證身份
- **乘客名單**：顯示當前班次所有乘客
- **乘車狀態**：標記乘客是否已上車

#### 站點管理
- **自動檢測**：當司機接近站點 50 公尺內自動標記為已到達
- **下一站提示**：自動計算並顯示下一站
- **路線規劃**：確保終點站（飯店）始終為最後一站

#### 角色管理
- **司機模式**：完整功能（GPS、出車管理等）
- **櫃台人員模式**：僅更新 Google Sheets，不影響 GPS 系統

---

### 4. **系統管理功能**

#### 系統設定
- **GPS 系統總開關**：透過 Google Sheets「系統」分頁 E19 控制
- **功能開關**：可控制即時位置功能顯示/隱藏
- **自動化規則**：自動關閉定位、站點檢測等

#### 資料同步
- **即時同步**：Firebase 與 Google Sheets 雙向同步
- **資料備份**：所有預約資料儲存在 Google Sheets
- **狀態追蹤**：即時追蹤行程狀態與位置

---

## 🔒 安全性與穩定性

### 資料安全
- **Google Cloud 部署**：所有服務部署於 Google Cloud Run
- **HTTPS 加密**：所有通訊採用 HTTPS 加密
- **權限控制**：使用 Google Service Account 進行權限管理
- **資料驗證**：前後端雙重驗證確保資料正確性

### 系統穩定性
- **錯誤處理**：完善的錯誤處理機制
- **健康檢查**：各服務提供健康檢查端點
- **自動重試**：網路錯誤時自動重試機制
- **快取機制**：減少 API 呼叫提升效能

---

## 📱 使用者介面特色

### 設計理念
- **簡潔直觀**：清晰的步驟引導
- **視覺回饋**：即時的視覺與觸覺回饋
- **無障礙設計**：符合無障礙使用標準
- **品牌一致性**：統一的視覺風格

### 互動體驗
- **流暢動畫**：平滑的頁面轉換動畫
- **即時驗證**：表單輸入即時驗證
- **狀態提示**：清楚的狀態提示與錯誤訊息
- **響應式設計**：完美適配各種螢幕尺寸

---

## 🌐 多語言支援

系統完整支援以下語言：
- **繁體中文**（預設）
- **English**
- **日本語**
- **한국어**

所有介面文字、錯誤訊息、通知等均支援多語言切換。

---

## 📊 系統優勢

### 1. **完整解決方案**
- 從預約到追蹤的完整流程
- 乘客端與司機端完整整合
- 即時資料同步與狀態管理

### 2. **雲端架構**
- 高可用性與擴展性
- 自動化部署與管理
- 成本效益優化

### 3. **使用者體驗**
- 直觀易用的介面設計
- 快速響應與流暢操作
- 多裝置完美適配

### 4. **管理便利性**
- 集中式資料管理（Google Sheets）
- 即時監控與控制
- 自動化流程減少人工操作

### 5. **技術先進性**
- 現代化技術架構
- 即時資料同步
- 自動化站點檢測
- 智能路線規劃

---

## 🚀 系統部署

### 部署環境
- **雲端平台**：Google Cloud Platform (GCP)
- **服務類型**：Cloud Run（無伺服器架構）
- **資料庫**：Google Sheets + Firebase Realtime Database
- **CDN**：Google Cloud CDN

### 服務端點（測試環境）
- **乘客網站**：`https://shuttle-web-509045429779.asia-east1.run.app`
- **預約管理 API**：`https://booking-manager-509045429779.asia-east1.run.app`
- **班次資料 API**：`https://booking-api-509045429779.asia-east1.run.app`
- **司機端 API**：`https://driver-api2-509045429779.asia-east1.run.app`

---

## 📈 未來擴展性

系統架構設計具備良好的擴展性，可支援：
- 更多站點與路線
- 更多語言支援
- 進階分析報表
- 簡訊通知功能
- 會員系統整合
- 其他飯店服務整合

---

## 📞 技術支援

如有任何問題或需要技術支援，請聯繫系統開發團隊。

---

**系統版本**：v1.1.122  
**最後更新**：2025年1月  
**開發團隊**：KZ Tech

