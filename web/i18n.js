/* ====== 語言包 ====== */
const TEXTS = {
  zh: {
    confirm: "確定",
    cancel: "取消",
    title: "飯店服務-免費接駁車預約",
    brand: "飯店服務",
    navReservation: "立即預約",
    navCheck: "我的預約",
    navSchedule: "查詢班次",
    navStation: "停靠站點",
    heroTitle: "免費接駁",
    bookNow: "立即預約",
    step1Title: "選擇方向",
    step2Title: "選擇日期",
    step3Title: "選擇站點",
    step4Title: "選擇班次",
    step5Title: "旅客資料填寫",
    step6Title: "確認班次資訊",
    labelDirection: "請選擇方向",
    directionHint: "去程固定由飯店出發，回程終點為飯店",
    labelDate: "請選擇日期",
    labelFixedStation: "固定站點",
    labelStation: "請選擇站點",
    labelSchedule: "請選擇班次",
    scheduleHint: "點選班次以繼續",
    labelScheduleOnly: "班次",
    labelIdentity: "請選擇您的身分",
    idHotel: "住宿貴賓",
    idDining: "用餐貴賓",
    labelCheckIn: "入住日期",
    labelCheckOut: "退房日期",
    labelDiningDate: "用餐日期",
    labelRoom: "房號",
    labelName: "貴賓姓名",
    labelPhone: "手機",
    labelEmail: "信箱",
    labelPick: "上車站點",
    labelDrop: "下車站點",
    labelPassengers: "預約人數（請選擇）",
    labelPassengersShort: "人數",
    errIdentity: "請選擇您的身分",
    errRoom: "請填寫正確的房號",
    roomHint: "尚未 CHECK IN 請輸入0000",
    errName: "限填中文或英文姓名",
    errPhone: "請輸入正確的手機號碼",
    errEmail: "請填寫正確的郵箱",
    errPassengers: "請選擇正確的人數（不可超過可預約人數或4人）",
    back: "返回",
    requery: "重新查詢",
    next: "下一步",
    submit: "提交預約",
    ticketTitle: "接駁車票",
    labelBookingId: "預約編號",
    labelScheduleDate: "班次",
    loading: "資料讀取中…",
    verifying: "資料確認中…",
    expiredTitle: "班次已過期或目前不可預約",
    expiredText: "請重新查詢可預約班次",
    successText: "已完成",
    queryTitle: "查詢訂單(已預約/取消/修改)",
    queryBookingId: "預約編號",
    queryPhone: "預約電話",
    queryEmail: "預約信箱",
    queryBtn: "查詢",
    clearBtn: "清除",
    queryHint: "*請擇一輸入",
    selectDateTitle: "選擇日期",
    backToQuery: "返回查詢",
    notice1: "※ 須於發車前一小時完成【預約／刪改】，座位有限，約滿為止。",
    notice2: "※ 房客、用餐客人可享免費預約搭乘。",
    download: "下載車票",
    rejectedTip: "如有疑問請聯繫櫃檯",
    scheduleCapacityLabel: "可預約", 
    dateCountPrefix: "有：",
    dateCountSuffix: " 筆預約",
    scheduleTitle: "查詢可預約班次",
    noSchedules: "沒有符合條件的班次",
    dirOutLabel: "去程（飯店出發）",
    dirInLabel: "回程（前往飯店）",

    realtimeTitle: "即時位置",
    all: "全部",
    editBookingTitle: "修改預約",
    phoneHint: "請輸入正確的手機號碼（可填寫非台灣手機號碼）",

    // 停靠站點
    stopsInfoTitle: "接駁車資訊",
    stopsInfoText: `<p><strong>※房客、用餐客人可享免費預約接駁，非房客或用餐客人預約接駁須收費每位NT$200/單趟，每趟次可搭乘19名旅客，座位有限，約滿為止。</strong></p>
                    <p><strong>※本飯店保有彈性調整發車時段，發車與否及車輛型式之權利。 車種介紹： 依預約人數安排白色20人中巴(車牌PAB-311)或鐵灰 色福斯九人座(車牌BLD-0361)</strong></p>`,
    stopHotelTitle: "福泰大飯店發車-側門出口 / Forte Hotel Xizhi Departure - Side Entrance",
    stopMRTTitle: "南港展覽館-捷運3號出口 / Nangang Exhibition Center - MRT Exit 3",
    stopTrainTitle: "南港火車站 / Nangang Train Station",
    stopLalaTitle: "南港 LaLaport Shopping Park",
    stopMRTDesc: "捷運南港展覽館 3 號出口 - 汽機車臨停接送區。",
    stopMRTDesc2: "停靠時間：08:35 / 10:05 / 12:05 / 14:35 / 17:05 / 18:35 / 21:05",
    stopTrainDesc: "南港火車站靠興中路一側上下客點(南港車站東側臨停接送區)",
    stopTrainDesc2: "停靠時間:08:40 / 10:10 / 12:10 / 14:40 / 17:10 / 18:40 / 21:10",
    stopLalaDesc: "南港展覽館1號出口大客車臨停區/小客車臨停區(視車種有不同停靠區)",
    stopLalaDesc2: "停靠時間：12:15 / 14:45 / 17:20 / 18:50 / 21:15",

    // 對話框
    errorTitle: "提交失敗",
    errorGeneric: "操作失敗，請稍後再試",
    ok: "確定",
    confirmDeleteTitle: "刪除預約",
    confirmDeleteText: "是否確認刪除此筆訂單？",
    cancel: "取消",
    confirm: "確認",
    submitFailedPrefix: "提交失敗：",
    deleteFailedPrefix: "刪除失敗：",
    updateFailedPrefix: "更新失敗：",
    refreshFailedPrefix: "資料更新失敗：",
    queryFailedPrefix: "查詢失敗：",
    paxHintPrefix: "此班次可預約：",
    paxHintSuffix: " 人；單筆最多 4 人",
    overPaxOrMissing: "班次已不存在或已超過可預訂人數，請重新查詢預約。"
  },
  en: {
    title: "Hotel Service - Free Shuttle Booking",
    brand: "Hotel Service",
    navReservation: "Book Now",
    navCheck: "My Bookings",
    navSchedule: "Find Schedules",
    navStation: "Stops",
    heroTitle: "Free Shuttle",
    bookNow: "Book Now",
    step1Title: "Select Direction",
    step2Title: "Select Date",
    step3Title: "Select Stop",
    step4Title: "Select Time",
    step5Title: "Passenger Details",
    step6Title: "Confirm Trip",
    labelDirection: "Select direction",
    directionHint: "Outbound departs hotel. Inbound ends at hotel.",
    labelDate: "Select date",
    labelFixedStation: "Fixed Stop",
    labelStation: "Select stop",
    labelSchedule: "Select time",
    scheduleHint: "Tap a time to continue",
    labelScheduleOnly: "Time",
    labelIdentity: "Your identity",
    idHotel: "Hotel guest",
    idDining: "Dining guest",
    labelCheckIn: "Check-in date",
    labelCheckOut: "Check-out date",
    labelDiningDate: "Dining date",
    labelRoom: "Room",
    labelName: "Name",
    labelPhone: "Phone",
    labelEmail: "Email",
    labelPick: "Pickup",
    labelDrop: "Dropoff",
    labelPassengers: "Passengers (choose)",
    labelPassengersShort: "Pax",
    errIdentity: "Please choose identity",
    errRoom: "Invalid room",
    roomHint: "Not checked-in yet? Enter 0000",
    errName: "Chinese or English name only",
    errPhone: "Invalid phone",
    errEmail: "Invalid email",
    errPassengers: "Invalid passengers (max 4, must be available)",
    back: "Back",
    requery: "Re-query",
    next: "Next",
    submit: "Submit",
    ticketTitle: "Shuttle Ticket",
    labelBookingId: "Booking ID",
    labelScheduleDate: "Schedule",
    loading: "Loading…",
    verifying: "Verifying…",
    expiredTitle: "Trip expired or unavailable",
    expiredText: "Please re-query available trips",
    successText: "Completed",
    queryTitle: "Find Orders (Booked/Cancelled/Modify)",
    queryBookingId: "Booking ID",
    queryPhone: "Phone",
    queryEmail: "Email",
    queryBtn: "Search",
    clearBtn: "Clear",
    queryHint: "*Enter any one",
    selectDateTitle: "Select a date",
    backToQuery: "Back to search",
    notice1: "※ Please book/modify/cancel at least 1 hour before departure. Seats are limited.",
    notice2: "※ Hotel and dining guests ride free with reservation.",
    download: "Download Ticket",
    rejectedTip: "If you have questions please contact the front desk.",
    scheduleCapacityLabel: "Available",
    dateCountPrefix: "",
    dateCountSuffix: " booking(s)",
    scheduleTitle: "Find Available Schedules",
    noSchedules: "No matching schedules",
    dirOutLabel: "Outbound (from hotel)",
    dirInLabel: "Inbound (to hotel)",
    realtimeTitle: "Live location",
    all: "ALL",
    stopsInfoTitle: "Shuttle Info",
    stopsInfoText: `<p><strong>※ Hotel and dining guests ride free with reservation. Non-guests will be charged NT$200 per person per one-way ride. Max 19 passengers per trip; seats are limited.</strong></p>
                    <p><strong>※ We may adjust departure times and vehicle type. Vehicles: 20-seat white minibus (PAB-311) or 9-seat grey Volkswagen (BLD-0361), depending on reservations.</strong></p>`,
    stopHotelTitle: "Forte Hotel Xizhi Departure - Side Entrance",
    stopMRTTitle: "Nangang Exhibition Center - MRT Exit 3",
    stopTrainTitle: "Nangang Train Station",
    stopLalaTitle: "Nangang LaLaport Shopping Park",
    stopMRTDesc: "MRT Nangang Exhibition Center Exit 3 — Motor Vehicle Pick-up and Drop-off Area.",
    stopMRTDesc2: "Stop Times: 08:35 / 10:05 / 12:05 / 14:35 / 17:05 / 18:35 / 21:05",
    stopTrainDesc: "Nangang Station, Xingzhong Rd. side (East-side temporary pick-up/drop-off area)",
    stopTrainDesc2: "Stop Times: 08:40 / 10:10 / 12:10 / 14:40 / 17:10 / 18:40 / 21:10",
    stopLalaDesc: "Nangang Exhibition Hall Exit 1 (bus/van temporary stops vary by vehicle)",
    stopLalaDesc2: "Stop Times: 12:15 / 14:45 / 17:20 / 18:50 / 21:15",
    errorTitle: "Submission failed",
    errorGeneric: "Operation failed. Please try again later.",
    ok: "OK",
    confirmDeleteTitle: "Delete booking",
    confirmDeleteText: "Are you sure you want to delete this booking?",
    cancel: "Cancel",
    confirm: "Confirm",
    submitFailedPrefix: "Submit failed: ",
    deleteFailedPrefix: "Delete failed: ",
    updateFailedPrefix: "Update failed: ",
    refreshFailedPrefix: "Refresh failed: ",
    queryFailedPrefix: "Query failed: ",
    paxHintPrefix: "Available: ",
    paxHintSuffix: " seats; up to 4 per order",
    editBookingTitle: "Edit Booking",
    phoneHint: "Please enter a valid phone number (including non-Taiwan numbers)",
    overPaxOrMissing: "This trip no longer exists or is fully booked. Please search again."
  },
  ja: {
    title: "ホテルサービス-無料シャトル予約",
    brand: "ホテルサービス",
    navReservation: "今すぐ予約",
    navCheck: "予約の確認",
    navSchedule: "便查询",
    navStation: "停留所",
    heroTitle: "無料シャトル",
    bookNow: "今すぐ予約",
    step1Title: "方向を選択",
    step2Title: "日付を選択",
    step3Title: "停留所を選択",
    step4Title: "便を選択",
    step5Title: "お客様情報",
    step6Title: "便情報の確認",
    labelDirection: "方向を選択",
    directionHint: "往路はホテル発。復路はホテル行き。",
    labelDate: "日付を選択",
    labelFixedStation: "固定停留所",
    labelStation: "停留所を選択",
    labelSchedule: "便を選択",
    scheduleHint: "便をタップして続行",
    labelScheduleOnly: "便",
    labelIdentity: "区分を選択",
    idHotel: "宿泊客",
    idDining: "レストラン客",
    labelCheckIn: "チェックイン日",
    labelCheckOut: "チェックアウト日",
    labelDiningDate: "食事日",
    labelRoom: "部屋番号",
    labelName: "氏名",
    labelPhone: "電話",
    labelEmail: "メール",
    labelPick: "乗車場所",
    labelDrop: "降車場所",
    labelPassengers: "人数（選択）",
    labelPassengersShort: "人数",
    errIdentity: "区分を選択してください",
    errRoom: "部屋番号が正しくありません",
    roomHint: "未チェックインの方は 0000",
    errName: "氏名は中国語または英語のみ入力可能です",
    errPhone: "電話番号が正しくありません",
    errEmail: "メールが正しくありません",
    errPassengers: "人数が不正です（最大4、空席数以内）",
    back: "戻る",
    requery: "再検索",
    next: "次へ",
    submit: "送信",
    ticketTitle: "シャトル乗車券",
    labelBookingId: "予約番号",
    labelScheduleDate: "便",
    loading: "読み込み中…",
    verifying: "確認中…",
    expiredTitle: "便は期限切れまたは予約不可",
    expiredText: "予約可能な便を再検索してください",
    successText: "完了",
    queryTitle: "注文検索（予約済/取消/変更）",
    queryBookingId: "予約番号",
    queryPhone: "電話",
    queryEmail: "メール",
    queryBtn: "検索",
    clearBtn: "クリア",
    queryHint: "※ いずれか一つを入力",
    selectDateTitle: "日付を選択",
    backToQuery: "検索に戻る",
    notice1: "※ 出発1時間前までに予約／変更／取消を行ってください。席数に限りがあります。",
    notice2: "※ 宿泊客・レストラン客は無料で予約できます。",
    download: "乗車券をダウンロード",
    rejectedTip: "不明点はフロントにお問い合わせください。",
    scheduleCapacityLabel: "空席",
    dateCountPrefix: "",
    dateCountSuffix: "件の予約",
    scheduleTitle: "予約可能な便查询",
    noSchedules: "条件に合う便がありません",
    dirOutLabel: "往路（ホテル発）",
    dirInLabel: "復路（ホテル行き）",
    realtimeTitle: "リアルタイム位置",
    all: "すべて",
    stopsInfoTitle: "シャトル案内",
    stopsInfoText: `<p><strong>※ 宿泊客・レストラン客は予約により無料で乗車できます。非宿泊・非利用の場合は1名片道NT$200を頂戴します。1便最大19名、席数に限りがあります。</strong></p>
                    <p><strong>※ 出発時刻や車両は変更となる場合があります。予約状況により、白い20人乗りミニバス(PAB-311)または鉄灰色の9人乗りフォルクスワーゲン(BLD-0361)を手配します。</strong></p>`,
    stopHotelTitle: "福泰大飯店発-側門出口 / Forte Hotel Xizhi Departure - Side Entrance",
    stopMRTTitle: "南港展示館-MRT3番出口 / Nangang Exhibition Center - MRT Exit 3",
    stopTrainTitle: "南港駅 / Nangang Train Station",
    stopLalaTitle: "南港LaLaportショッピングパーク",
    stopMRTDesc: "MRT南港展示館3番出口 - 車・バイク一時停車送迎エリア。",
    stopMRTDesc2: "停車時刻：08:35 / 10:05 / 12:05 / 14:35 / 17:05 / 18:35 / 21:05",
    stopTrainDesc: "南港駅 興中路側の乗降場所（南港駅東側の一時停車送迎エリア）",
    stopTrainDesc2: "停車時刻：08:40 / 10:10 / 12:10 / 14:40 / 17:10 / 18:40 / 21:10",
    stopLalaDesc: "南港展示館1番出口 大型/小型車一時停車エリア（車種により停車位置が異なります）",
    stopLalaDesc2: "停車時刻：12:15 / 14:45 / 17:20 / 18:50 / 21:15",
    errorTitle: "送信失敗",
    errorGeneric: "操作に失敗しました。しばらくしてからお試しください。",
    ok: "OK",
    confirmDeleteTitle: "予約を削除",
    confirmDeleteText: "この予約を削除してもよろしいですか？",
    cancel: "キャンセル",
    confirm: "確認",
    submitFailedPrefix: "送信失敗：",
    deleteFailedPrefix: "削除失敗：",
    updateFailedPrefix: "更新失敗：",
    refreshFailedPrefix: "更新失敗：",
    queryFailedPrefix: "検索失敗：",
    paxHintPrefix: "空き：",
    paxHintSuffix: " 人；1回の予約で最大4名",
    editBookingTitle: "予約を編集",
    phoneHint: "正しい電話番号を入力してください（台湾以外の番号も可）",
    overPaxOrMissing: "便が存在しないか満席です。再度検索してください。"
  },
  ko: {
    title: "호텔 서비스-무료 셔틀 예약",
    brand: "호텔 서비스",
    navReservation: "바로 예약",
    navCheck: "내 예약",
    navSchedule: "일정 조회",
    navStation: "정차역",
    heroTitle: "무료 셔틀",
    bookNow: "바로 예약",
    step1Title: "방향 선택",
    step2Title: "날짜 선택",
    step3Title: "정차역 선택",
    step4Title: "시간 선택",
    step5Title: "탑승자 정보",
    step6Title: "정보 확인",
    labelDirection: "방향을 선택",
    directionHint: "가는편은 호텔 출발, 오는편은 호텔 도착.",
    labelDate: "날짜 선택",
    labelFixedStation: "고정 정차역",
    labelStation: "정차역 선택",
    labelSchedule: "시간 선택",
    scheduleHint: "시간을 눌러 진행",
    labelScheduleOnly: "시간",
    labelIdentity: "구분 선택",
    idHotel: "숙박객",
    idDining: "식사객",
    labelCheckIn: "체크인",
    labelCheckOut: "체크아웃",
    labelDiningDate: "식사일",
    labelRoom: "객실",
    labelName: "이름",
    labelPhone: "전화",
    labelEmail: "이메일",
    labelPick: "승차",
    labelDrop: "하차",
    labelPassengers: "인원수(선택)",
    labelPassengersShort: "인원",
    errIdentity: "구분을 선택하세요",
    errRoom: "객실번호가 올바르지 않습니다",
    roomHint: "체크인 전이면 0000",
    errName: "중국어 또는 영어 이름만 입력 가능합니다",
    errPhone: "전화번호가 올바르지 않습니다",
    errEmail: "이메일이 올바르지 않습니다",
    errPassengers: "인원수가 올바르지 않습니다(최대 4, 잔여석 이내)",
    back: "뒤로",
    requery: "재검색",
    next: "다음",
    submit: "제출",
    ticketTitle: "셔틀 승차권",
    labelBookingId: "예약번호",
    labelScheduleDate: "편",
    loading: "로드 중…",
    verifying: "확인 중…",
    expiredTitle: "편이 만료되었거나 예약 불가",
    expiredText: "예약 가능한 편을 재검색하세요",
    successText: "완료",
    queryTitle: "주문 조회(예약/취소/수정)",
    queryBookingId: "예약번호",
    queryPhone: "전화",
    queryEmail: "이메일",
    queryBtn: "조회",
    clearBtn: "초기화",
    queryHint: "*하나 이상 입력",
    selectDateTitle: "날짜 선택",
    backToQuery: "조회로 돌아가기",
    notice1: "※ 출발 1시간 전까지 예약·변경·취소해 주세요. 좌석 한정.",
    notice2: "※ 숙박객 및 식사객은 예약 시 무료 탑승.",
    download: "티켓 다운로드",
    rejectedTip: "문의 사항은 프런트에 연락하세요.",
    scheduleCapacityLabel: "예약 가능",
    dateCountPrefix: "",
    dateCountSuffix: "건 예약",
    scheduleTitle: "예약 가능한 일정 조회",
    noSchedules: "조건에 맞는 일정이 없습니다",
    dirOutLabel: "가는편(호텔 출발)",
    dirInLabel: "오는편(호텔 도착)",
    realtimeTitle: "실시간 위치",
    all: "전체",
    stopsInfoTitle: "셔틀 정보",
    stopsInfoText: `<p><strong>※ 숙박/식사 고객은 예약 시 무료 탑승. 비고객은 1인 편도 NT$200. 회당 최대 19명, 좌석 한정.</strong></p>
                    <p><strong>※ 출발 시간과 차량은 변동될 수 있습니다. 예약 인원에 따라 20인승 백색 미니버스(PAB-311) 또는 9인승 회색 폭스바겐(BLD-0361)을 배차합니다.</strong></p>`,
    stopHotelTitle: "포르테 호텔 시즈 출발 - 측문",
    stopMRTTitle: "난강 전람관 - MRT 3번 출구",
    stopTrainTitle: "난강역",
    stopLalaTitle: "난강 라라포트 쇼핑파크",
    stopMRTDesc: "MRT 난강 전람관 3번 출구 — 차량 임시 승하차 구역.",
    stopMRTDesc2: "시간: 08:35 / 10:05 / 12:05 / 14:35 / 17:05 / 18:35 / 21:05",
    stopTrainDesc: "난강역 흥중로 측 승하차 (동측 임시 승하차 구역)",
    stopTrainDesc2: "시간: 08:40 / 10:10 / 12:10 / 14:40 / 17:10 / 18:40 / 21:10",
    stopLalaDesc: "난강 전람관 1번 출구 대형/소형차 임시 정차 구역(차종에 따라 다름)",
    stopLalaDesc2: "시간: 12:15 / 14:45 / 17:20 / 18:50 / 21:15",
    errorTitle: "제출 실패",
    errorGeneric: "작업에 실패했습니다. 잠시 후 다시 시도하세요.",
    ok: "확인",
    confirmDeleteTitle: "예약 삭제",
    confirmDeleteText: "이 예약을 삭제하시겠습니까?",
    cancel: "취소",
    confirm: "확인",
    submitFailedPrefix: "제출 실패: ",
    deleteFailedPrefix: "삭제 실패: ",
    updateFailedPrefix: "업데이트 실패: ",
    refreshFailedPrefix: "새로고침 실패: ",
    queryFailedPrefix: "조회 실패: ",
    paxHintPrefix: "예약 가능: ",
    paxHintSuffix: "명; 주문당 최대 4명",
    editBookingTitle: "예약 수정",
    phoneHint: "정확한 휴대폰 번호를 입력하세요(대만 번호가 아니어도 입력 가능)",
    overPaxOrMissing: "해당 편은 존재하지 않거나 예약 가능 인원을 초과했습니다. 다시 조회해주세요."
  }
};

/* 狀態文案 */
const I18N_STATUS = {
  zh: {
    booked: "✔️ 已預約",
    cancelled: "❌ 已取消",
    rejected: "已拒絕",
    boarded: "已上車",
    expired: "已過期",
    download: "下載車票",
    modify: "修改",
    remove: "刪除",
    noRecords: "查無符合條件的紀錄（僅顯示近一個月）",
    includeSelf: "（含本人）"
  },
  en: {
    booked: "✔️ Booked",
    cancelled: "❌ Cancelled",
    rejected: "Rejected",
    boarded: "Boarded",
    expired: "Expired",
    download: "Download ticket",
    modify: "Edit",
    remove: "Delete",
    noRecords: "No matching records (last 30 days only)",
    includeSelf: " (incl. you)"
  },
  ja: {
    booked: "✔️ 予約済み",
    cancelled: "❌ キャンセル",
    rejected: "拒否",
    boarded: "乗車済み",
    expired: "期限切れ",
    download: "チケットをダウンロード",
    modify: "変更",
    remove: "削除",
    noRecords: "該当データがありません（直近30日）",
    includeSelf: "（本人含む）"
  },
  ko: {
    booked: "✔️ 예약됨",
    cancelled: "❌ 취소됨",
    rejected: "거절됨",
    boarded: "탑승완료",
    expired: "만료",
    download: "티켓 다운로드",
    modify: "수정",
    remove: "삭제",
    noRecords: "일치하는 기록 없음 (최근 30일)",
    includeSelf: "(본인 포함)"
  }
};

let currentLang = "zh";
window.currentLang = currentLang; 
function t(key) {
  return (TEXTS[currentLang] || TEXTS.zh)[key] || key;
}
function ts(key) {
  return (I18N_STATUS[currentLang] || I18N_STATUS.zh)[key] || "";
}

function applyI18N() {
  document.title = t("title");

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const k = el.getAttribute("data-i18n");
    const v = t(k);
    if (v != null) el.textContent = v;
  });

  // 支援 innerHTML
  document.querySelectorAll("[data-i18n-html]").forEach((el) => {
    const k = el.getAttribute("data-i18n-html");
    const v = t(k);
    if (v != null) el.innerHTML = v;
  });

  const pill = document.getElementById("successStatusPill");
  if (pill) pill.textContent = ts("booked");
}

function onLanguageChange(lang) {
  currentLang = lang || "zh";
  window.currentLang = currentLang;  
  applyI18N();

  // 查詢 / 票卡列表重繪（狀態文案）
  if (typeof rerenderQueryPages === "function") {
    rerenderQueryPages();
  }

  // Step1 方向按鈕
  if (
    document.getElementById("step1") &&
    document.getElementById("step1").style.display !== "none" &&
    typeof buildStep1 === "function"
  ) {
    buildStep1();
  }

  // ✅ 班次查詢頁：去程 / 回程 / 其他文字即時更新
  if (
    typeof renderScheduleFilters === "function" &&
    scheduleData.rows &&
    scheduleData.rows.length
  ) {
    renderScheduleFilters();
    renderScheduleResults();
  }

  // ✅ 跑馬燈：語言切換時重新渲染一次（如果有文案）
  if (typeof showMarquee === "function" && marqueeData.isLoaded) {
    showMarquee();
  }
}
