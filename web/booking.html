<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title data-i18n="title">飯店服務-免費接駁車預約</title>
  <style>
    :root{
      --primary:#A98570;
      --secondary:#8f7147;
      --bg:#f5f5f5;
      --card:#fff;
      --text:#333;
      --muted:#777;
      --disabled:#c7c7c7;
      --radius:14px;
      --shadow:0 2px 8px rgba(0,0,0,.08);
      --shadow-lg:0 10px 30px rgba(0,0,0,.15);
      --green:#2e7d32;
      --red:#b00020;
      --gray:#9e9e9e;
    }

    *{box-sizing:border-box}
    html, body { height:100%; }
    html, body {
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,"PingFang TC","Microsoft JhengHei",Segoe UI,Roboto,Arial,sans-serif;
      min-height:100vh;
      -webkit-text-size-adjust:100%;
    }

    /* 只讓 body 做 flex 排版，並預留跑馬燈高度 52px */
    body {
      display:flex;
      flex-direction:column;
      padding-top:24px;  /* 跟 .marquee-container 的 height 一樣 */
    }

    /* 跑馬燈 */
    .marquee-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 60;
      /* 主題色 #A98570，20% 透明 */
      background: rgba(169, 133, 112, 1);
      color: #fff;
      display: flex;              /* 讓文字和 X 同一行 */
      align-items: center;
      padding: 0 48px 0 18px;     /* 右邊留空給關閉按鈕 */
      height: 24px;               /* 高一點 */
      font-size: 18px;            /* 字大一點 */
      line-height: 24px;
      overflow: hidden;
    }
    
    /* 關閉按鈕（右上角的 ✕） */
    .marquee-close {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    /* 跑馬文字本體 */
    .marquee-content {
      white-space: nowrap;
      display: inline-block;
      padding-left: 100%; /* 從容器右側開始滾動 */
      animation: marquee 30s linear infinite;
      font-size: 18px;
      font-weight: 500;
    }

    @keyframes marquee {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-100%);
      }
    }
    /* 懸停時暫停動畫 */
    .marquee-container:hover .marquee-content {
      animation-play-state: paused;
    }
    /* 圖片展示區 */

    .image-gallery {
      display: flex;
      flex-direction: column;   /* 垂直排列 */
      gap: 16px;
      margin-top: 20px;
    }

    .gallery-image {
      width: 100%;
      height: auto;             /* 不裁切圖片比例 */
      border-radius: 12px;      /* ✅ 跟原本一樣導圓角 */
      box-shadow: var(--shadow);/* ✅ 保留原本的陰影效果 */
      display: block;           /* 保險一點，避免有奇怪空隙 */
    }



    .navbar{
      position:sticky;top:0;z-index:50;
      top:24px;               /* 讓 navbar 永遠在跑馬燈下面 */
      display:flex;align-items:center;
      padding:12px 16px;background:var(--card);box-shadow:0 1px 4px rgba(0,0,0,.06)
    }
    .brand{display:flex;align-items:center;gap:10px;margin-right: 30px;}
    .brand img{height:28px;width:auto;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.08)}
    .brand-title{font-weight:800;font-size:18px; cursor: pointer;}
    .brand-title:hover{color:var(--primary);}

    .nav-right{display:flex;align-items:center;gap:12px;margin-left:auto}
    .lang-wrap span { font-size: 12px; }
    .nav-links{display:flex;gap:8px}
    .nav-links button{
      background:none;border:none;padding:8px 10px;border-radius:10px;cursor:pointer;
      font-size:14px
    }
    .nav-links button.active,.nav-links button:hover{color:var(--primary);background:#f3eee6}

    select{
      appearance:none;padding:8px 28px 8px 10px;border:1px solid #ddd;border-radius:10px;background:white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="10" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>') no-repeat right 8px center/14px
    }

    .page{display:none;padding:20px;max-width:980px;margin:0 auto;flex:1}
    .page.active{display:block}

    /* 即時位置 - 預留容器樣式 */
    .realtime-box {
      margin-top: 8px;
      min-height: 320px;  /* 先給保留高度，未嵌入前也不突兀 */
      border-radius: 12px;
      background: #fafafa;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* ★ 統一電腦版預約流程卡片寬度（33vw，固定） */
    .wizard-fixed{ width:100%; }
    @media (min-width: 1024px){
      .wizard-fixed{ width:66vw; min-width:620px; max-width:920px; margin-left:auto; margin-right:auto; }
    }

    .hero{
      max-width:840px;margin:18px auto 16px;background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:24px 20px;text-align:center
    }
    .hero h1{margin:0 0 12px;font-size:30px;font-weight:900}
    .hero p{margin:0;color:var(--muted)}

    .button{
      display:inline-block;min-width:160px;
      border:none;border-radius:14px;padding:14px 18px;font-size:16px;font-weight:700;cursor:pointer;background:var(--primary);color:#fff;
      transition:transform .06s ease,filter .2s ease
    }
    .button:disabled{ opacity:.6; cursor:not-allowed; }
    .button:active{transform:translateY(1px)}
    .btn-ghost{background:#eee;color:#333}

    .grid{display:grid;gap:14px}
    .card{ background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:18px }
    .card h2{margin:0 0 12px;font-size:20px;font-weight:800;text-align:center}
    .station-page .card h2 { text-align: left; }

    .field{margin:8px 0}
    .label{display:block;margin-bottom:6px;font-weight:700}
    .hint{font-size:12px;color:var(--muted)}

    .input,.select,.readonly{ width:100%;padding:12px 14px;border:1px solid #ddd;border-radius:12px;background:#fff;font-size:16px }
    .readonly{background:#f4f4f4;color:#666}

    .error{color:#b00020;font-size:13px;margin-top:6px;display:none}

    .options{display:flex;flex-direction:column;gap:10px}
    .opt-btn{
      text-align:left;padding:14px 16px;border:1px solid #e7e7e7;border-radius:12px;background:#fff;font-weight:800;color:var(--primary);cursor:pointer;
      font-size:18px;
    }
    .opt-btn:hover{box-shadow:var(--shadow)}
    .opt-btn.active{outline:3px solid rgba(169,133,112,.25)}
    .opt-btn.disabled{color:#bbb;background:#f7f7f7;border-color:#eee;cursor:not-allowed}

    .actions{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:8px}
    .actions.row{flex-direction:row}
    .actions.col{flex-direction:column}

    /* 覆蓋層 */
    .overlay{ position:fixed;inset:0;background:rgba(255,255,255,.94);display:none;align-items:center;justify-content:center;z-index:9999; pointer-events:none }
    .overlay.show{display:flex; pointer-events:auto}
    .spinner{width:48px;height:48px;border-radius:50%;border:4px solid #eee;border-top:4px solid var(--primary);animation:spin 1s linear infinite;margin:0 auto 10px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .overlay-card{background:#fff;border-radius:16px;box-shadow:var(--shadow-lg);padding:22px;max-width:680px;text-align:left}
    .overlay-card h3{margin:0 0 8px;font-size:20px}

    /* 對話框（錯誤/確認） */
    .dialog-content p{ margin:8px 0 0; color:#444; line-height:1.6; }
    .dialog-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:14px; }
    .dialog-actions .button{ min-width:120px; }

    @keyframes shake {0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-5px)}20%,40%,60%,80%{transform:translateX(5px)}}
    .shake{animation:shake .5s ease-in-out}

    .query-form{display:flex;flex-direction:column;gap:14px}

    .footer{ background:#f5f5f5;color:#666;text-align:center;padding:20px;margin-top:auto;border-top:1px solid #e0e0e0;width:100%; }

    /* 手機底部導覽（白字） */
    .mobile-tabbar{ position:fixed;left:0;right:0;bottom:0;display:none;z-index:40; background:var(--primary);border-top:1px solid #e9e9e9;box-shadow:0 -2px 12px rgba(0,0,0,.06) }
    .mobile-tabbar .bar{display:grid;grid-template-columns:repeat(4,1fr);gap:0}
    .mobile-tabbar button{ appearance:none;border:none;background:none;padding:12px 6px;font-size:18px;color:#fff;font-weight:700;opacity:.8 }
    .mobile-tabbar button.active{opacity:1;text-decoration:underline}

    /* 回到頂端按鈕 */
    #backToTop{
      position:fixed;right:18px;bottom:24px;z-index:1000;display:none;width:44px;height:44px;border:none;border-radius:50%;cursor:pointer;background:#0009;color:#fff;font-size:22px;line-height:44px;text-align:center
    }
    #backToTop:hover{filter:brightness(1.2)}
    @media (max-width: 768px){ #backToTop{ bottom:96px; } }

    /* 成功動畫（3秒） */
    .success-animation{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10000;background:rgba(255,255,255,.95);border-radius:16px;padding:30px;box-shadow:var(--shadow-lg);display:none;align-items:center;justify-content:center;flex-direction:column;pointer-events:none}
    .success-animation.show{display:flex;animation:fadeInOut 3s ease-in-out;pointer-events:auto}
    .checkmark{width:80px;height:80px;border-radius:50%;display:block;stroke:#4CAF50;stroke-width:2;stroke-miterlimit:10;margin:20px auto;box-shadow:inset 0 0 0 0 #4CAF50;animation:fill .4s ease-in-out .4s forwards,scale .3s ease-in-out .9s both}
    .checkmark__circle{stroke-dasharray:166;stroke-dashoffset:166;stroke:#4CAF50;stroke-width:2;stroke-miterlimit:10;fill:none;animation:stroke .6s cubic-bezier(.65,0,.45,1) forwards}
    .checkmark__check{transform-origin:50% 50%;stroke-dasharray:48;stroke-dashoffset:48;stroke:#fff;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;vector-effect:non-scaling-stroke;animation:stroke .3s cubic-bezier(.65,0,.45,1) .8s forwards}
    @keyframes stroke{100%{stroke-dashoffset:0}}
    @keyframes scale{0%,100%{transform:none}50%{transform:scale3d(1.1,1.1,1)}}
    @keyframes fill{100%{box-shadow:inset 0 0 0 40px #4CAF50}}
    @keyframes fadeInOut{0%{opacity:0}20%{opacity:1}80%{opacity:1}100%{opacity:0}}

    /* 車票卡片 */
    .ticket-card { position:relative; background: white; border-radius: 16px; box-shadow: var(--shadow-lg); padding: 20px; margin: 20px auto; max-width: 820px; width: 100%; }
    .ticket-card.expired{filter:grayscale(1);opacity:.7}
    .status-pill{position:absolute;left:12px;top:12px;border-radius:999px;padding:4px 10px;font-size:12px;font-weight:800;color:#fff}
    .status-booked{background:var(--green)}
    .status-cancelled{background:var(--red)}
    .status-rejected{background:#d2691e}
    .status-boarded{background:#1976d2}
    .status-expired{background:var(--gray)}

    .ticket-header { text-align: center; margin-bottom: 24px; border-bottom: 2px solid var(--primary); padding-bottom: 16px; }
    .ticket-header h2 { margin: 0; font-size: 28px; font-weight: 900; color: var(--primary); }

    .ticket-close{
      position:absolute;right:12px;top:12px;width:36px;height:36px;border-radius:50%;border:none;background:#00000022;color:#333;font-size:18px;cursor:pointer;line-height:36px;text-align:center
    }

    .ticket-content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start; }
    .ticket-qr { text-align: center; padding: 20px; background: #f9f9f9; border-radius: 12px; min-height: 200px; }
    .ticket-qr img { width: 200px; height: 200px; border-radius: 8px; border: 1px solid #eee; background: #fff; object-fit: contain; }
    .ticket-info { display: flex; flex-direction: column; gap: 12px; }
    .ticket-field { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
    .ticket-field:last-child { border-bottom: none; }
    .ticket-label { font-weight: 800; color: var(--text); min-width: 120px; font-size: 18px; }
    .ticket-value { flex: 1; text-align: right; color: var(--muted); font-size: 18px; overflow-wrap: anywhere; word-break: break-word; }
    .ticket-actions { margin-top: 24px; display: flex; gap: 12px; justify-content: center; flex-direction: row-reverse; }

    .date-group{margin-bottom:20px;background:#fff;border-radius:14px;box-shadow:var(--shadow)}
    .date-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #eee;cursor:pointer}
    .date-title{font-weight:900}
    .date-count{color:#666;font-size:13px}
    .tickets-row{display:flex;gap:12px;padding:14px;overflow-x:auto;scroll-snap-type:x mandatory}
    .tickets-row .ticket-card{scroll-snap-align:start;flex:0 0 auto}

    .check-date-card.wizard-fixed{}
    .ticket-page .ticket-card{ max-width: 1000px; width:100%; }

    /* === 手機版 === */
    @media (max-width: 768px) {
      .ticket-card { width: 95%; max-width: 95%; box-sizing: border-box; margin: 0 auto; padding: 14px; overflow: hidden; }
      .ticket-content { display: flex; flex-direction: column; align-items: center; gap: 12px; }
      .ticket-info { width: 100%; word-wrap: break-word; }
      .ticket-qr img { width: 160px; height: 160px; max-width: 100%; }
      .hero .actions { justify-content: center !important; }
      .footer { font-size: 70%; padding: 15px 10px; }
      .tickets-row{flex-direction:column;overflow-x:hidden}
      .ticket-card{width:100%;max-width:100%}

      /* 手機版更換logo */
      .brand img[src="/images/logo.png"] {
        content: url("/images/logo2.png");
      }
    }

    #step6 .field { margin: 4px 0; }
    #step6 .label, #step6 .readonly { line-height: 1.2; }

    /* === 手機版修正 === */
    @media (max-width: 768px) {
      html, body { width: 100%; max-width: 100%; overflow-x: hidden; }
      .page, .card, .ticket-card { width: 100%; max-width: 100%; margin: 0 auto; box-sizing: border-box; }
      .nav-links { display: none; }
      .mobile-tabbar { display: block; }
      body { padding-bottom: 70px; }
      .navbar { justify-content: space-between; }
      .brand { margin-right: 0; }
      .actions { display: flex !important; flex-direction: row !important; justify-content: space-between !important; align-items: center !important; width: 100%; max-width: 340px; margin: 10px auto 0; gap: 10px; }
      .actions button { flex: 1; min-width: 120px; max-width: 160px; font-size: 15px; }
      .actions.has-three { flex-direction: column !important; align-items: center !important; justify-content: center !important; }
      .actions.has-three button { width: 80%; max-width: 320px; }
      .ticket-card { margin: 0 auto 20px; padding: 16px; overflow: visible; }
      .ticket-actions { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 10px; width: 100%; margin-top: 16px; }
      .ticket-actions:not(.has-three) button { flex: 1; min-width: 140px; max-width: 160px; font-size: 15px; }
      .ticket-actions.has-three { flex-direction: column; align-items: center; }
      .ticket-actions.has-three button:nth-child(1),
      .ticket-actions.has-three button:nth-child(2) { width: 45%; max-width: 180px; }
      .ticket-actions.has-three button:nth-child(3) { width: 80%; max-width: 300px; }
    }

    .badge-alert{
      position:absolute; right:60px; top:12px;
      width:28px;height:28px;border-radius:50%;border:none;background:#ffcc80;color:#8a4b08;font-weight:900;cursor:pointer;
    }

    /* === 查詢班次頁面樣式 === */
    .filter-controls { margin-bottom: 20px; }
    .filter-group { margin-bottom: 15px; }
    .filter-pills { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
    .filter-pill { padding: 8px 16px; border: 1px solid #ddd; border-radius: 20px; background: white; cursor: pointer; font-size: 14px; transition: all 0.2s; }
    .filter-pill.active { background: var(--primary); color: white; border-color: var(--primary); }
    .filter-pill:hover { box-shadow: var(--shadow); }
    .schedule-results { margin-top: 20px; }
    .schedule-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: var(--shadow); border-left: 4px solid var(--primary); }
    .schedule-line { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
    .schedule-line:last-child { margin-bottom: 0; }
    .schedule-direction { font-weight: 800; color: var(--primary); font-size: 16px; }
    .schedule-time { font-weight: 700; color: var(--text); }
    .schedule-date { color: var(--muted); }
    .schedule-station { flex: 1; color: var(--text); }
    .schedule-capacity { color: var(--green); font-weight: 700; }
    .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); }
    .loading-text { text-align: center; padding: 20px; color: var(--muted); }

    /* === 可收合區塊 === */
    .collapsible .collapsible-header{
      display:flex; align-items:center; justify-content:space-between; cursor:pointer;
    }
    .collapsible .toggle-icon{ font-size:18px; color:#777; }
    .collapsible .collapsible-content{ display:none; margin-top:12px; }
    .collapsible.open .collapsible-content{ display:block; }
  </style>
</head>
<body>
  <!-- 跑馬燈 -->
  <div id="marqueeContainer" class="marquee-container">
    <div id="marqueeContent" class="marquee-content"></div>
    <button class="marquee-close" onclick="closeMarquee()">✕</button>
  </div>

  <!-- 頂部導覽 -->
  <header class="navbar">
    <div class="brand" onclick="window.open('https://www.fortehotelxizhi.com.tw/','_blank')" style="cursor:pointer">
      <img src="/images/logo.png" alt="logo" />
      <div class="brand-title" data-i18n="brand">飯店服務</div>
    </div>

    <div class="nav-links">
      <button id="nav-reservation" class="active" onclick="showPage('reservation')" data-i18n="navReservation">立即預約</button>
      <button id="nav-check" onclick="showPage('check')" data-i18n="navCheck">我的預約</button>
      <button id="nav-schedule" onclick="showPage('schedule')" data-i18n="navSchedule">查詢班次</button>
      <button id="nav-station" onclick="showPage('station')" data-i18n="navStation">停靠站點</button>
    </div>

    <div class="nav-right">
      <div class="lang-wrap">
        <span>Language</span>
        <select id="languageSelect" onchange="onLanguageChange(this.value)">
          <option value="zh" selected>中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
        </select>
      </div>
    </div>
  </header>

  <!-- 手機底部導覽 -->
  <nav class="mobile-tabbar">
    <div class="bar">
      <button id="m-reservation" class="active" onclick="showPage('reservation')" data-i18n="navReservation">立即預約</button>
      <button id="m-check" onclick="showPage('check')" data-i18n="navCheck">我的預約</button>
      <button id="m-schedule" onclick="showPage('schedule')" data-i18n="navSchedule">查詢班次</button>
      <button id="m-station" onclick="showPage('station')" data-i18n="navStation">停靠站點</button>
    </div>
  </nav>

  <!-- 回到頂端 -->
  <button id="backToTop" title="Back to top" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</button>

  <!-- 預約流程 -->
  <main id="reservation" class="page active">
    <section id="homeHero" class="hero">
      <h1 data-i18n="heroTitle">免費接駁</h1>
      <div class="actions" style="margin-top:8px">
        <button class="button" onclick="startBooking()" data-i18n="bookNow">立即預約</button>
      </div>
      <div style="margin-top:16px">
        <img src="/images/時刻表.webp" alt="時刻表" style="width:100%;max-width:820px;border-radius:14px;box-shadow:var(--shadow)"/>
      </div>

      <!-- 圖片展示 -->
      <div id="imageGallery" class="image-gallery"></div>
    </section>

    <!-- Step 1：方向 -->
    <section id="step1" class="card wizard-fixed" style="display:none">
      <h2 data-i18n="step1Title">選擇方向</h2>
      <div class="field">
        <label class="label" data-i18n="labelDirection">請選擇方向<span style="color:#b00020">*</span></label>
        <div id="directionList" class="options"></div>
      </div>
      <div class="hint" data-i18n="directionHint">去程固定由飯店出發，回程終點為飯店</div>
      <div class="actions">
        <button class="button btn-ghost" onclick="restart()" data-i18n="requery">重新查詢</button>
      </div>
    </section>

    <!-- Step 2：日期 -->
    <section id="step2" class="card wizard-fixed" style="display:none">
      <h2 data-i18n="step2Title">選擇日期</h2>
      <div class="field">
        <label class="label" data-i18n="labelDate">請選擇日期<span style="color:#b00020">*</span></label>
        <div id="dateList" class="options"></div>
      </div>
      <div class="actions">
        <button class="button btn-ghost" onclick="goStep(1)" data-i18n="back">返回</button>
        <button class="button btn-ghost" onclick="restart()" data-i18n="requery">重新查詢</button>
      </div>
    </section>

    <!-- Step 3：站點 -->
    <section id="step3" class="card wizard-fixed" style="display:none">
      <h2 data-i18n="step3Title">選擇站點</h2>
      <div class="field">
        <label class="label" data-i18n="labelFixedStation">固定站點</label>
        <input id="fixedStation" class="readonly" type="text" readonly value="福泰大飯店 Forte Hotel" />
      </div>
      <div class="field">
        <label class="label" data-i18n="labelStation">請選擇站點<span style="color:#b00020">*</span></label>
        <div id="stationList" class="options"></div>
      </div>
      <div class="actions">
        <button class="button btn-ghost" onclick="goStep(2)" data-i18n="back">返回</button>
        <button class="button btn-ghost" onclick="restart()" data-i18n="requery">重新查詢</button>
      </div>
    </section>

    <!-- Step 4：班次 -->
    <section id="step4" class="card wizard-fixed" style="display:none">
      <h2 data-i18n="step4Title">選擇班次</h2>
      <div class="field">
        <label class="label" data-i18n="labelSchedule">請選擇班次<span style="color:#b00020">*</span></label>
        <div id="scheduleList" class="options"></div>
        <div class="hint" data-i18n="scheduleHint">點選班次以繼續</div>
      </div>
      <div class="actions">
        <button class="button btn-ghost" onclick="goStep(3)" data-i18n="back">返回</button>
        <button id="btnStep4Restart" class="button btn-ghost" onclick="restart()" data-i18n="requery">重新查詢</button>
      </div>
    </section>

    <!-- Step 5：旅客資料 -->
    <section id="step5" class="card wizard-fixed" style="display:none">
      <h2 data-i18n="step5Title">旅客資料填寫</h2>
      <div class="field">
        <label class="label" data-i18n="labelIdentity">請選擇您的身分<span style="color:#b00020">*</span></label>
        <select id="identitySelect" class="select" onchange="onIdentityChange()">
          <option value="hotel" selected data-i18n="idHotel">住宿貴賓</option>
          <option value="dining" data-i18n="idDining">用餐貴賓</option>
        </select>
        <div id="identityErr" class="error" data-i18n="errIdentity">請選擇您的身分</div>
      </div>

      <div id="hotelDates" class="field" style="display:none">
        <label class="label" data-i18n="labelCheckIn">入住日期<span style="color:#b00020">*</span></label>
        <input id="checkInDate" type="date" class="input" />
      </div>
      <div id="hotelDates2" class="field" style="display:none">
        <label class="label" data-i18n="labelCheckOut">退房日期<span style="color:#b00020">*</span></label>
        <input id="checkOutDate" type="date" class="input" />
      </div>

      <div id="diningDateDiv" class="field" style="display:none">
        <label class="label" data-i18n="labelDiningDate">用餐日期<span style="color:#b00020">*</span></label>
        <input id="diningDate" type="date" class="input" />
      </div>

      <div id="roomNumberDiv" class="field" style="display:none">
        <label class="label" data-i18n="labelRoom">房號<span style="color:#b00020">*</span></label>
        <input id="roomNumber" type="text" class="input" placeholder="" oninput="validateRoom(this)" />
        <div id="roomErr" class="error" data-i18n="errRoom">請填寫正確的房號</div>
        <div class="hint" data-i18n="roomHint">尚未 CHECK IN 請輸入0000</div>
      </div>

      <div class="field">
        <label class="label" data-i18n="labelName">貴賓姓名<span style="color:#b00020">*</span></label>
        <input id="guestName" type="text" class="input" oninput="validateName(this)" />
        <div id="nameErr" class="error" data-i18n="errName">請填寫姓名</div>
      </div>
      <div class="field">
        <label class="label" data-i18n="labelPhone">手機<span style="color:#b00020">*</span></label>
        <input id="guestPhone" type="tel" class="input" placeholder="+886921234567" oninput="validatePhone(this)" />
        <div id="phoneErr" class="error" data-i18n="errPhone">請輸入正確的手機號碼</div>
        <div class="hint" data-i18n="phoneHint">請輸入正確的手機號碼（可填寫非台灣手機號碼）</div>
      </div>
      <div class="field">
        <label class="label" data-i18n="labelEmail">信箱<span style="color:#b00020">*</span></label>
        <input id="guestEmail" type="email" class="input" placeholder="name@example.com" oninput="validateEmail(this)" />
        <div id="emailErr" class="error" data-i18n="errEmail">請填寫正確的郵箱</div>
      </div>

      <div class="actions">
        <button class="button btn-ghost" onclick="goStep(4)" data-i18n="back">返回</button>
        <button class="button btn-ghost" onclick="restart()" data-i18n="requery">重新查詢</button>
        <button class="button" type="button" onclick="toStep6()" data-i18n="next">下一步</button>
      </div>
    </section>

    <!-- Step 6：確認與送出 -->
    <section id="step6" class="card wizard-fixed" style="display:none">
      <h2 data-i18n="step6Title">確認班次資訊</h2>
      <div class="grid">
        <div class="field"><label class="label" data-i18n="labelDirection">方向</label><input id="cf_direction" class="readonly" readonly/></div>
        <div class="field"><label class="label" data-i18n="labelDate">日期</label><input id="cf_date" class="readonly" readonly/></div>
        <div class="field"><label class="label" data-i18n="labelPick">上車站點</label><input id="cf_pick" class="readonly" readonly/></div>
        <div class="field"><label class="label" data-i18n="labelDrop">下車站點</label><input id="cf_drop" class="readonly" readonly/></div>
        <div class="field"><label class="label" data-i18n="labelScheduleOnly">班次</label><input id="cf_time" class="readonly" readonly/></div>
        <div class="field"><label class="label" data-i18n="labelName">姓名</label><input id="cf_name" class="readonly" readonly/></div>
      </div>
      <div class="field">
        <label class="label" data-i18n="labelPassengers">預約人數（請選擇）<span style="color:#b00020">*</span></label>
        <select id="passengers" class="select"></select>
        <div id="passengersHint" class="hint"></div>
        <div id="passengersErr" class="error" data-i18n="errPassengers">請選擇正確的人數（不可超過可預約人數或4人）</div>
      </div>
      <div class="actions row">
        <button class="button btn-ghost" onclick="goStep(5)" data-i18n="back">返回</button>
        <button class="button" onclick="submitBooking()" data-i18n="submit">提交預約</button>
      </div>
    </section>

    <!-- 成功卡片 -->
    <section id="successCard" class="card wizard-fixed" style="display:none">
      <div id="ticketCard" class="ticket-card">
        <div class="status-pill status-booked" id="successStatusPill">✔️ 已預約</div>
        <button class="ticket-close" onclick="closeTicketToHome()" aria-label="close">✕</button>
        <div class="ticket-header"><h2 data-i18n="ticketTitle">接駁車票</h2></div>
        <div class="ticket-content">
          <div class="ticket-qr"><img id="ticketQrImg" src="" alt="QR Code"/></div>
          <div class="ticket-info">
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelBookingId">預約編號</span><span class="ticket-value" id="ticketBookingId"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelScheduleDate">班次</span><span class="ticket-value" id="ticketSchedule"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelDirection">方向</span><span class="ticket-value" id="ticketDirection"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelPick">上車地點</span><span class="ticket-value" id="ticketPick"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelDrop">下車地點</span><span class="ticket-value" id="ticketDrop"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelName">姓名</span><span class="ticket-value" id="ticketName"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelPhone">手機</span><span class="ticket-value" id="ticketPhone"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelEmail">信箱</span><span class="ticket-value" id="ticketEmail"></span></div>
            <div class="ticket-field"><span class="ticket-label" data-i18n="labelPassengersShort">人數</span><span class="ticket-value" id="ticketPassengers"></span></div>
          </div>
        </div>
        <div class="ticket-actions">
          <button class="button" onclick="downloadTicket()" data-i18n="download">下載車票</button>
        </div>
      </div>
    </section>
  </main>

  <!-- 我的預約 -->
  <main id="check" class="page">
    <div class="card wizard-fixed">
      <h2 data-i18n="queryTitle">查詢訂單(已預約/取消/修改)</h2>
      <div class="card" style="margin:0 0 12px;background:#fff7ea">
        <div style="font-size:14px;color:#6b4b22;line-height:1.6">
          <span data-i18n="notice1">※ 須於發車前一小時完成【預約／刪改】，座位有限，約滿為止。</span><br/>
          <span data-i18n="notice2">※ 房客、用餐客人可享免費預約搭乘。</span>
        </div>
      </div>

      <div id="queryForm" class="query-form">
        <div class="field"><label class="label" data-i18n="queryBookingId">預約編號</label><input id="qBookId" class="input" placeholder="1109001"/></div>
        <div class="field"><label class="label" data-i18n="queryPhone">預約電話</label><input id="qPhone" class="input" placeholder="+8869..."/></div>
        <div class="field"><label class="label" data-i18n="queryEmail">預約信箱</label><input id="qEmail" class="input" placeholder="name@example.com"/></div>
        <div class="field" style="display:flex;align-items:flex-end;gap:8px">
          <button class="button" onclick="queryOrders()" data-i18n="queryBtn">查詢</button>
          <button class="button btn-ghost" onclick="resetQuery()" data-i18n="clearBtn">清除</button>
        </div>
      </div>
      <div id="queryHint" style="margin-top:6px;font-weight:800;color:#b00020" data-i18n="queryHint">*請擇一輸入</div>
    </div>

    <!-- 查詢後：日期選擇頁 -->
    <div id="checkDateStep" class="card wizard-fixed check-date-card" style="display:none">
      <h2 data-i18n="selectDateTitle">選擇日期</h2>
      <div id="dateChoices" class="options"></div>
      <div class="actions" style="margin-top:12px">
        <button class="button btn-ghost" onclick="showCheckQueryForm()" data-i18n="backToQuery">返回查詢</button>
      </div>
    </div>

    <!-- 查詢後：票卡頁 -->
    <div id="checkTicketStep" class="card wizard-fixed ticket-page" style="display:none">
      <div style="position:relative">
        <button class="ticket-close" onclick="closeCheckTicket()" aria-label="close">✕</button>
        <div class="ticket-header">
          <h2 data-i18n="ticketTitle">接駁車票</h2>
        </div>
      </div>
      <div id="checkTicketMount"></div>
    </div>
  </main>

  <!-- 查詢班次 -->
  <main id="schedule" class="page">
    <section class="card wizard-fixed">
      <h2 data-i18n="scheduleTitle">查詢可預約班次</h2>

      <!-- 單一 ALL 清除鈕 -->
      <div class="filter-group">
        <div id="allFilter" class="filter-pills"></div>
      </div>

      <!-- 篩選控件 -->
      <div class="filter-controls">
        <div class="filter-group">
          <label class="label" data-i18n="labelDirection">方向</label>
          <div id="directionFilter" class="filter-pills"></div>
        </div>

        <div class="filter-group">
          <label class="label" data-i18n="labelDate">日期</label>
          <div id="dateFilter" class="filter-pills"></div>
        </div>

        <div class="filter-group">
          <label class="label" data-i18n="labelStation">站點</label>
          <div id="stationFilter" class="filter-pills"></div>
        </div>
      </div>

      <!-- 結果展示 -->
      <div id="scheduleResults" class="schedule-results">
        <div class="loading-text" data-i18n="loading">資料讀取中…</div>
      </div>
    </section>
  </main>

  <!-- 停靠站點 -->
  <main id="station" class="page station-page">
    <div class="grid">
      <!-- 第一區：接駁車資訊（不收合） -->
      <section class="card">
        <h2 class="station-title" style="text-align:center" data-i18n="stopsInfoTitle">
          接駁車資訊
        </h2>
        <div class="station-info" data-i18n-html="stopsInfoText">
          <p><strong>※房客、用餐客人可享免費預約接駁，非房客或用餐客人預約接駁須收費每位NT$200/單趟，每趟次可搭乘19名旅客，座位有限，約滿為止。</strong></p>
          <p><strong>※本飯店保有彈性調整發車時段，發車與否及車輛型式之權利。車種介紹：依預約人數安排白色20人中巴(車牌PAB-311)或鐵灰色福斯九人座(車牌BLD-0361)</strong></p>
        </div>

          <!-- 這裡放一張橫向長方形圖片：檔名可自行替換 -->
          <div class="station-info-image-wrap">
            <img src="/images/車種1.png"
                 alt="接駁車資訊示意圖"
                 class="station-info-img" />
          </div>
      </section>

      <!-- 第二區：福泰大飯店發車（可收合，預設收起） -->
      <section class="card collapsible" id="stopHotel">
        <div class="collapsible-header" onclick="toggleCollapse('stopHotel')">
          <h2 data-i18n="stopHotelTitle">
            福泰大飯店發車-側門出口 / Forte Hotel Xizhi Departure - Side Entrance
          </h2>
          <span class="toggle-icon">▸</span>
        </div>
        <div class="collapsible-content">
          <!-- 若之後要加說明文字，可用跟其他站一樣的 pattern：
          <div class="station-desc">
            <div data-i18n="stopHotelDesc1">...</div>
            <div data-i18n="stopHotelDesc2">...</div>
          </div>
          -->
          <img src="/images/飯店1.jpg" class="station-img" alt="飯店發車點"/>
          <div style="margin-top:12px">
            <iframe src="https://www.google.com/maps/embed?pb=!1m13!1m8!1m3!1d903.5965295503805!2d121.631097!3d25.054899!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zMjXCsDAzJzE3LjQiTiAxMjHCsDM3JzUyLjEiRQ!5e0!3m2!1szh-TW!2sus!4v1762533754549!5m2!1szh-TW!2us"
                    width="100%" height="380"
                    style="border:0;border-radius:12px"
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 第三區：南港展覽館（可收合，預設收起） -->
      <section class="card collapsible" id="stopMRT">
        <div class="collapsible-header" onclick="toggleCollapse('stopMRT')">
          <h2 data-i18n="stopMRTTitle">
            南港展覽館捷運站 / Nangang Exhibition Center - MRT Exit 3
          </h2>
          <span class="toggle-icon">▸</span>
        </div>
        <div class="collapsible-content">
          <div class="station-desc">
            <div data-i18n="stopMRTDesc">
              捷運南港展覽館 3 號出口 - 汽機車臨停接送區。
            </div>
            <div data-i18n="stopMRTDesc2">
              停靠時間：08:35 / 10:05 / 12:05 / 14:35 / 17:05 / 18:35 / 21:05
            </div>
          </div>
          <img src="/images/捷運1.png" class="station-img" alt="捷運3號出口"/>
          <div style="margin-top:12px">
            <iframe src="https://www.google.com/maps/embed?pb=!1m13!1m8!1m3!1d903.5957185825895!2d121.61843600000002!3d25.055009!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zMjXCsDAzJzE4LjEiTiAxMjHCsDM3JzA1LjUiRQ!5e0!3m2!1szh-TW!2us!4v1762600714030!5m2!1szh-TW!2us"
                    width="100%" height="380"
                    style="border:0;border-radius:12px"
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 第四區：南港火車站（可收合，預設收起） -->
      <section class="card collapsible" id="stopTrain">
        <div class="collapsible-header" onclick="toggleCollapse('stopTrain')">
          <h2 data-i18n="stopTrainTitle">
            南港火車站 / Nangang Train Station
          </h2>
          <span class="toggle-icon">▸</span>
        </div>
        <div class="collapsible-content">
          <div class="station-desc">
            <div data-i18n="stopTrainDesc">
              南港火車站靠興中路一側上下客點（南港車站東側臨停接送區）。
            </div>
            <div data-i18n="stopTrainDesc2">
              停靠時間：08:40 / 10:10 / 12:10 / 14:40 / 17:10 / 18:40 / 21:10
            </div>
          </div>
          <img src="/images/火車站1.png" class="station-img" alt="南港火車站1"/>
          <img src="/images/火車站2.png" class="station-img" alt="南港火車站2"/>
          <div style="margin-top:12px">
            <iframe src="https://www.google.com/maps/embed?pb=!1m13!1m8!1m3!1d903.6109052447401!2d121.60801199999999!3d25.052949!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zMjXCsDAzJzEwLjMiTiAxMjHCsDM2JzI4LjAiRQ!5e0!3m2!1szh-TW!2us!4v1762600699115!5m2!1szh-TW!2us"
                    width="100%" height="380"
                    style="border:0;border-radius:12px"
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 第五區：LaLaport（可收合，預設收起） -->
      <section class="card collapsible" id="stopLala">
        <div class="collapsible-header" onclick="toggleCollapse('stopLala')">
          <h2 data-i18n="stopLalaTitle">
            南港 LaLaport Shopping Park
          </h2>
          <span class="toggle-icon">▸</span>
        </div>
        <div class="collapsible-content">
          <div class="station-desc">
            <div data-i18n="stopLalaDesc">
              南港展覽館 1 號出口大客車臨停區 / 小客車臨停區（視車種有不同停靠區）。
            </div>
            <div data-i18n="stopLalaDesc2">
              停靠時間：12:15 / 14:45 / 17:20 / 18:50 / 21:15
            </div>
          </div>
          <img src="/images/lala1.png" class="station-img" alt="LaLaport1"/>
          <img src="/images/lala2.png" class="station-img" alt="LaLaport2"/>
          <div style="margin-top:12px">
            <iframe src="https://www.google.com/maps/embed?pb=!1m13!1m8!1m3!1d903.5851167154738!2d121.617376!3d25.056447!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zMjXCsDAzJzIyLjciTiAxMjHCsDM3JzAxLjQiRQ!5e0!3m2!1szh-TW!2us!4v1762600680118!5m2!1szh-TW!2us"
                    width="100%" height="380"
                    style="border:0;border-radius:12px"
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    allowfullscreen></iframe>
          </div>
        </div>
      </section>


      <!-- 查詢班次 - 即時位置（保留區塊 @ 停靠站點頁） -->
      <section id="realtimeSection" class="card wizard-fixed station-page" data-feature="liveLocation" style="display:none">
        <h2 data-i18n="realtimeTitle">即時位置</h2>
        <div id="realtimeMount" class="realtime-box" aria-live="polite"></div>
      </section>

    </div>
  </main>

  <!-- 底部 -->
  <footer class="footer">
    © 2025. Forte Hotel XiZhi汐止福泰大飯店. <a href="https://kz-tech.netlify.app/" target="_blank">Design</a>
  </footer>

  <!-- Loading / Overlay -->
  <div id="loading" class="overlay">
    <div>
      <div class="spinner"></div>
      <div style="text-align:center;color:var(--primary);font-weight:700" data-i18n="loading">資料讀取中…</div>
    </div>
  </div>
  <div id="loadingConfirm" class="overlay">
    <div>
      <div class="spinner"></div>
      <div style="text-align:center;color:var(--primary);font-weight:700" data-i18n="verifying">資料確認中…</div>
    </div>
  </div>
  <div id="expiredOverlay" class="overlay">
    <div class="overlay-card">
      <h3 data-i18n="expiredTitle">班次已過期或目前不可預約</h3>
      <p data-i18n="expiredText">請重新查詢可預約班次</p>
      <div class="actions" style="margin-top:8px">
        <button id="overlayBackBtn" class="button" onclick="overlayRestart()" data-i18n="requery">重新查詢</button>
      </div>
    </div>
  </div>

  <!-- 通用對話框（錯誤/確認） -->
  <div id="dialogOverlay" class="overlay">
    <div class="overlay-card" role="dialog" aria-modal="true" aria-labelledby="dialogTitle">
      <h3 id="dialogTitle">訊息</h3>
      <div id="dialogContent" class="dialog-content"></div>
      <div class="dialog-actions">
        <button id="dialogCancelBtn" class="button btn-ghost" style="display:none"></button>
        <button id="dialogConfirmBtn" class="button"></button>
      </div>
    </div>
  </div>

  <!-- 成功動畫 -->
  <div id="successAnimation" class="success-animation" aria-live="polite">
    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
      <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
      <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
    </svg>
    <div id="successText" style="font-size: 24px; font-weight: 700; color: #4CAF50;" data-i18n="successText">已完成</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
  <script src="./i18n.js"></script>
  <script src="./app.js"></script>
</body>
</html>
