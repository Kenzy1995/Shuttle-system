name: Deploy Booking Manager to Cloud Run

on:
  push:
    paths:
      - 'booking-manager/**'
    branches: [ main ]

env:
  PROJECT_ID: '${{ secrets.GCP_PROJECT_ID }}'
  SERVICE: booking-manager
  REGION: asia-east1
  SERVICE_ACCOUNT: forte-booking-system@forte-booking-system.iam.gserviceaccount.com

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Google Auth
      id: auth
      uses: 'google-github-actions/auth@v1'
      with:
        credentials_json: '${{ secrets.GCP_CREDENTIALS }}'

    - name: Deploy to Cloud Run
      uses: google-github-actions/deploy-cloudrun@v1
      with:
        service: ${{ env.SERVICE }}
        region: ${{ env.REGION }}
        source: ./booking-manager
        flags: |
          --allow-unauthenticated
          --service-account=${{ env.SERVICE_ACCOUNT }}
