# ğŸ”§ åˆå§‹åŒ– Firebase Realtime Database

## âŒ å•é¡Œè¨ºæ–·

Firebase Realtime Database æ˜¯ç©ºçš„ï¼Œé€™å¯èƒ½å°è‡´é–å®šæ©Ÿåˆ¶ç„¡æ³•æ­£å¸¸å·¥ä½œã€‚

---

## ğŸ” æ ¹æœ¬åŸå› 

ç³»çµ±ä½¿ç”¨ä»¥ä¸‹ Firebase è·¯å¾‘ï¼š
- `/sheet_locks` - ç”¨æ–¼ä½µç™¼é–ï¼ˆé¿å…åŒæ™‚é ç´„é€ æˆè¶…è³£ï¼‰
- `/booking_seq` - ç”¨æ–¼é ç´„åºè™Ÿ

å¦‚æœé€™äº›è·¯å¾‘ä¸å­˜åœ¨ï¼ŒFirebase äº¤æ˜“å¯èƒ½ç„¡æ³•æ­£å¸¸å·¥ä½œã€‚

---

## âœ… è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ³• 1: æ‰‹å‹•åˆå§‹åŒ–ï¼ˆæ¨è–¦ï¼‰

1. **å‰å¾€ Firebase Console**ï¼š
   - https://console.firebase.google.com/project/shuttle-system-60d6a/database/shuttle-system-60d6a-default-rtdb/data

2. **å‰µå»ºå¿…è¦çš„è·¯å¾‘çµæ§‹**ï¼š
   - é»æ“Šæ ¹ç¯€é»ï¼ˆ`/`ï¼‰
   - æ·»åŠ ä»¥ä¸‹çµæ§‹ï¼š

```json
{
  "sheet_locks": {},
  "booking_seq": {}
}
```

3. **ä¿å­˜æ›´æ”¹**

### æ–¹æ³• 2: é€šéä»£ç¢¼è‡ªå‹•åˆå§‹åŒ–ï¼ˆå¦‚æœéœ€è¦çš„è©±ï¼‰

å¦‚æœç³»çµ±åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ™‚è‡ªå‹•å‰µå»ºé€™äº›è·¯å¾‘ï¼Œå¯ä»¥å˜—è©¦é€²è¡Œä¸€æ¬¡é ç´„æ“ä½œï¼Œç³»çµ±æ‡‰è©²æœƒè‡ªå‹•å‰µå»ºé€™äº›è·¯å¾‘ã€‚

ä½†æ ¹æ“šç•¶å‰å•é¡Œï¼Œæ‰‹å‹•åˆå§‹åŒ–å¯èƒ½æ›´å¯é ã€‚

---

## ğŸ“‹ åˆå§‹åŒ–æ­¥é©Ÿ

### æ­¥é©Ÿ 1: æ‰“é–‹ Firebase Console

å‰å¾€ï¼š
- https://console.firebase.google.com/project/shuttle-system-60d6a/database/shuttle-system-60d6a-default-rtdb/data

### æ­¥é©Ÿ 2: å‰µå»ºè·¯å¾‘çµæ§‹

1. å¦‚æœæ•¸æ“šåº«æ˜¯ç©ºçš„ï¼Œé»æ“Šã€Œ+ æ·»åŠ å­ç¯€é»ã€
2. å‰µå»ºä»¥ä¸‹çµæ§‹ï¼š

**è·¯å¾‘ 1: `sheet_locks`**
- éµåï¼š`sheet_locks`
- é¡å‹ï¼šå°è±¡ï¼ˆObjectï¼‰
- å€¼ï¼š`{}`ï¼ˆç©ºå°è±¡ï¼‰

**è·¯å¾‘ 2: `booking_seq`**
- éµåï¼š`booking_seq`
- é¡å‹ï¼šå°è±¡ï¼ˆObjectï¼‰
- å€¼ï¼š`{}`ï¼ˆç©ºå°è±¡ï¼‰

### æ­¥é©Ÿ 3: ç¢ºèªçµæ§‹

æœ€çµ‚çµæ§‹æ‡‰è©²å¦‚ä¸‹ï¼š

```
/
â”œâ”€â”€ sheet_locks: {}
â””â”€â”€ booking_seq: {}
```

---

## ğŸ” é©—è­‰æ­¥é©Ÿ

### 1. æª¢æŸ¥è·¯å¾‘æ˜¯å¦å­˜åœ¨

åœ¨ Firebase Console ä¸­ç¢ºèªï¼š
- `/sheet_locks` å­˜åœ¨
- `/booking_seq` å­˜åœ¨

### 2. æ¸¬è©¦é ç´„åŠŸèƒ½

åˆå§‹åŒ–å¾Œï¼Œå˜—è©¦é€²è¡Œä¸€æ¬¡é ç´„ï¼Œæª¢æŸ¥ï¼š
- é–å®šæ˜¯å¦æ­£å¸¸å·¥ä½œ
- æ˜¯å¦ä¸å†å‡ºç¾è¶…æ™‚éŒ¯èª¤

### 3. æª¢æŸ¥æ—¥èªŒ

æŸ¥çœ‹ Cloud Run æ—¥èªŒï¼Œç¢ºèªï¼š
- ä¸å†å‡ºç¾ `[cap_lock] timeout` éŒ¯èª¤
- å¯ä»¥çœ‹åˆ° `[cap_lock] acquired` æˆ– `[cap_lock] poll` è¨Šæ¯

---

## âš ï¸ é‡è¦æç¤º

1. **ä¸è¦åˆªé™¤é€™äº›è·¯å¾‘**ï¼šé€™äº›è·¯å¾‘æ˜¯ç³»çµ±æ­£å¸¸é‹ä½œæ‰€å¿…éœ€çš„
2. **ä¿æŒçµæ§‹ç°¡å–®**ï¼šåªéœ€è¦ç©ºå°è±¡ `{}`ï¼Œä¸éœ€è¦å…¶ä»–æ•¸æ“š
3. **è¦å‰‡è¨­ç½®**ï¼šç¢ºèª Firebase è¦å‰‡è¨­ç½®ç‚ºèˆ‡èˆŠç‰ˆæœ¬ä¸€è‡´ï¼ˆ`false`ï¼‰

---

## ğŸ”— ç›¸é—œé€£çµ

- Firebase Consoleï¼šhttps://console.firebase.google.com/project/shuttle-system-60d6a/database/shuttle-system-60d6a-default-rtdb/data
- Firebase è¦å‰‡ï¼šhttps://console.firebase.google.com/project/shuttle-system-60d6a/database/shuttle-system-60d6a-default-rtdb/rules

---

## ğŸ¯ å¿«é€Ÿä¿®å¾©

1. å‰å¾€ Firebase Console
2. å‰µå»º `sheet_locks` å’Œ `booking_seq` å…©å€‹ç©ºå°è±¡
3. ä¿å­˜æ›´æ”¹
4. æ¸¬è©¦é ç´„åŠŸèƒ½

---

## ğŸ“ æ³¨æ„äº‹é …

- é€™äº›è·¯å¾‘æœƒåœ¨ç³»çµ±ä½¿ç”¨æ™‚è‡ªå‹•å¡«å……æ•¸æ“š
- ä¸éœ€è¦æ‰‹å‹•æ·»åŠ å…·é«”çš„é–å®šæˆ–åºè™Ÿæ•¸æ“š
- åªéœ€è¦ç¢ºä¿è·¯å¾‘çµæ§‹å­˜åœ¨å³å¯

