# ğŸ”§ Firebase è¦å‰‡è¨­ç½® - A/B æ¸¬è©¦ç‰ˆæœ¬

## âœ… æ­£ç¢ºçš„è¦å‰‡è¨­ç½®ï¼ˆèˆ‡èˆŠç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼‰

ç‚ºäº†é€²è¡Œ A/B æ¸¬è©¦ï¼Œ**è¦å‰‡æ‡‰è©²èˆ‡èˆŠç‰ˆæœ¬å®Œå…¨ä¸€è‡´**ï¼š

```json
{
  "rules": {
    ".read": false,
    ".write": false,

    "sheet_locks": {
      ".read": false,
      ".write": false
    },

    "booking_seq": {
      ".read": false,
      ".write": false
    },

    "realtime_locations": {
      ".read": "auth != null",
      ".write": "auth != null"
    }
  }
}
```

---

## ğŸ”‘ ç‚ºä»€éº¼èˆŠç‰ˆæœ¬å¯ä»¥å·¥ä½œï¼Ÿ

**Firebase Admin SDK æœƒç¹éå®‰å…¨è¦å‰‡**ï¼

å³ä½¿è¦å‰‡è¨­ç½®ç‚º `false`ï¼ŒFirebase Admin SDK ä½¿ç”¨æœå‹™å¸³è™Ÿæ†‘è­‰æ™‚ä»ç„¶å¯ä»¥è¨ªå•æ•¸æ“šåº«ï¼Œå› ç‚ºï¼š

1. **Admin SDK æœ‰ç®¡ç†å“¡æ¬Šé™**ï¼šå®ƒæœƒç¹éæ‰€æœ‰å®‰å…¨è¦å‰‡
2. **è¨ªå•ç”± GCP IAM æ§åˆ¶**ï¼šå¯¦éš›çš„è¨ªå•æ§åˆ¶ç”± GCP IAM æ¬Šé™æ±ºå®šï¼Œè€Œä¸æ˜¯å®‰å…¨è¦å‰‡
3. **å®‰å…¨è¦å‰‡ä¸»è¦ç”¨æ–¼å®¢æˆ¶ç«¯**ï¼šè¦å‰‡ä¸»è¦æ§åˆ¶ Web å’Œ Mobile å®¢æˆ¶ç«¯çš„è¨ªå•

---

## ğŸ”§ å¦‚æœå‡ºç¾æ¬Šé™éŒ¯èª¤ï¼Œæ‡‰è©²æ€éº¼åšï¼Ÿ

### æ­£ç¢ºåšæ³•ï¼šæˆäºˆæ¬Šé™ï¼Œè€Œä¸æ˜¯æ”¹è®Šè¦å‰‡

å¦‚æœå‡ºç¾ `UnauthenticatedError`ï¼Œå•é¡Œåœ¨æ–¼**æœå‹™å¸³è™Ÿçš„ GCP IAM æ¬Šé™**ï¼Œè€Œä¸æ˜¯å®‰å…¨è¦å‰‡ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. âœ… æˆäºˆæœå‹™å¸³è™Ÿ Firebase Admin æ¬Šé™ï¼ˆå·²å®Œæˆï¼‰
2. âœ… ä¿æŒè¦å‰‡èˆ‡èˆŠç‰ˆæœ¬ä¸€è‡´ï¼ˆ`false` è¨­ç½®ï¼‰
3. âŒ **ä¸è¦**æ”¹è®Šè¦å‰‡ç‚º `true`

---

## ğŸ“‹ ç•¶å‰ç‹€æ…‹

### å·²å®Œæˆçš„æ¬Šé™æˆäºˆ

æœå‹™å¸³è™Ÿ `shuttle-system@shuttle-system-487204.iam.gserviceaccount.com` å·²æ“æœ‰ï¼š
- âœ… `roles/firebase.admin` - Firebase ç®¡ç†å“¡æ¬Šé™
- âœ… `roles/datastore.user` - Datastore ç”¨æˆ¶æ¬Šé™

### è¦å‰‡è¨­ç½®

è¦å‰‡æ‡‰è©²è¨­ç½®ç‚ºèˆ‡èˆŠç‰ˆæœ¬ä¸€è‡´ï¼ˆ`false`ï¼‰ï¼Œå› ç‚ºï¼š
- Firebase Admin SDK æœƒç¹éè¦å‰‡
- è¦å‰‡ä¸»è¦ç”¨æ–¼å®¢æˆ¶ç«¯è¨ªå•æ§åˆ¶
- ä¿æŒä¸€è‡´æ€§æœ‰åˆ©æ–¼ A/B æ¸¬è©¦

---

## ğŸ” ç•¶å‰å•é¡Œè¨ºæ–·

å¾æœ€æ–°æ—¥èªŒçœ‹åˆ°ï¼š
- âœ… Firebase åˆå§‹åŒ–æˆåŠŸï¼š`Firebase: Initialization successful`
- âš ï¸ é–å®šè¶…æ™‚ï¼š`[cap_lock] timeout`

é€™è¡¨ç¤ºï¼š
1. **Firebase é€£æ¥æ­£å¸¸**ï¼šåˆå§‹åŒ–æˆåŠŸ
2. **æ¬Šé™å¯èƒ½å·²ä¿®å¾©**ï¼šæ²’æœ‰çœ‹åˆ° `UnauthenticatedError`
3. **é–å®šæ©Ÿåˆ¶å•é¡Œ**ï¼šå¯èƒ½æ˜¯é–å®šé‚è¼¯æœ¬èº«çš„å•é¡Œï¼Œè€Œä¸æ˜¯æ¬Šé™å•é¡Œ

---

## âœ… é©—è­‰æ­¥é©Ÿ

1. **ç¢ºèªè¦å‰‡è¨­ç½®ç‚ºèˆ‡èˆŠç‰ˆæœ¬ä¸€è‡´**ï¼ˆ`false`ï¼‰

2. **æª¢æŸ¥æœå‹™å¸³è™Ÿæ¬Šé™**ï¼š
   ```bash
   gcloud projects get-iam-policy shuttle-system-487204 \
     --flatten="bindings[].members" \
     --filter="bindings.members:serviceAccount:shuttle-system@shuttle-system-487204.iam.gserviceaccount.com" \
     --format="table(bindings.role)"
   ```

3. **æª¢æŸ¥ Firebase åˆå§‹åŒ–æ—¥èªŒ**ï¼š
   - æ‡‰è©²çœ‹åˆ° `Firebase: Initialization successful`
   - ä¸æ‡‰è©²çœ‹åˆ° `UnauthenticatedError`

4. **å¦‚æœé–å®šä»ç„¶è¶…æ™‚**ï¼š
   - å¯èƒ½æ˜¯é–å®šé‚è¼¯æœ¬èº«çš„å•é¡Œ
   - æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–æœå‹™å¯¦ä¾‹æŒæœ‰é–å®š
   - æª¢æŸ¥é–å®šéæœŸæ™‚é–“è¨­ç½®

---

## ğŸ¯ ç¸½çµ

**è¦å‰‡æ‡‰è©²èˆ‡èˆŠç‰ˆæœ¬ä¿æŒä¸€è‡´**ï¼Œå› ç‚ºï¼š
1. Firebase Admin SDK æœƒç¹éå®‰å…¨è¦å‰‡
2. è¨ªå•æ§åˆ¶ç”± GCP IAM æ¬Šé™æ±ºå®š
3. ä¿æŒä¸€è‡´æ€§æœ‰åˆ©æ–¼ A/B æ¸¬è©¦

**å¦‚æœå‡ºç¾æ¬Šé™å•é¡Œ**ï¼š
- âœ… æˆäºˆ GCP IAM æ¬Šé™ï¼ˆå·²å®Œæˆï¼‰
- âœ… ä¿æŒè¦å‰‡ä¸è®Šï¼ˆèˆ‡èˆŠç‰ˆæœ¬ä¸€è‡´ï¼‰
- âŒ ä¸è¦æ”¹è®Šè¦å‰‡ç‚º `true`

---

## ğŸ”— ç›¸é—œé€£çµ

- Firebase Console è¦å‰‡ï¼šhttps://console.firebase.google.com/project/shuttle-system-60d6a/database/shuttle-system-60d6a-default-rtdb/rules
- GCP IAMï¼šhttps://console.cloud.google.com/iam-admin/iam?project=shuttle-system-487204

